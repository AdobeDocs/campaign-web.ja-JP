---
audience: end-user
title: クエリモデラーを使用した最初のクエリの作成
description: Adobe Campaign web クエリモデラーで最初のクエリを作成する方法を学びます。
badge: label="限定提供（LA）"
source-git-commit: ac136ed0467b2fda4b3d9ba2a05ee6878523138f
workflow-type: tm+mt
source-wordcount: '1860'
ht-degree: 64%

---

# 最初のクエリの作成 {#build-query}

クエリの作成を開始するには、実行するアクションに応じて、選択した場所からクエリモデラーにアクセスします。クエリモデラーが開き、空白のキャンバスが表示されます。「**+**」ボタンをクリックして、クエリの最初のノードを設定します。

次の 2 種類の要素を追加できます。

* **コンポーネントのフィルタリング**（カスタム条件、オーディエンスを選択、定義済みフィルター）を使用すると、独自のルールを作成したり、オーディエンスまたは定義済みフィルターを選択してクエリを絞り込んだりできます。[詳しくは、コンポーネントフィルタリングの操作方法を参照してください](#filtering)

  例：

  *「スポーツ」ニュースレターを購読した受信者*。*ニューヨークに住む受信者*、*サンフランシスコに住む受信者*

* **グループ演算子**（AND、OR、EXCEPT）を使用すると、ニーズに合わせて、ダイアグラム内のフィルタリングコンポーネントをグループ化できます。[詳しくは、演算子の操作方法を参照してください](#filtering)

  例：

  *「スポーツ」ニュースレターを購読した受信者&#x200B;**および**ニューヨーク&#x200B;**または**サンフランシスコに住む受信者*。

![](assets/query-add-component.png){width="70%" align="center"}

## フィルタリングコンポーネントの追加 {#filtering}

コンポーネントをフィルタリングすると、次を使用してクエリを絞り込むことができます。

* **カスタム条件**：データベースの属性と高度な式を使用して独自の条件を作成し、クエリをフィルタリングします。
* **オーディエンス**：既存のオーディエンスを使用してクエリをフィルタリングします。
* **定義済みフィルター**：既存の定義済みフィルターを使用してクエリをフィルタリングします。

### カスタム条件の設定

>[!CONTEXTUALHELP]
>id="acw_orchestration_querymodeler_customcondition"
>title="カスタム条件"
>abstract="カスタム条件"

カスタム条件を使用してクエリをフィルタリングするには、次の手順に従います。

1. 目的のノードの「**+**」ボタンをクリックし、「**[!UICONTROL カスタム条件]**」を選択します。右側にカスタム条件のプロパティパネルが開きます。

1. 「**属性**」フィールドで、条件の作成に活用するデータベースから属性を選択します。属性リストには、リンクされたテーブルの属性を含め、Campaign データベースのすべての属性が含まれます。

   ![](assets/query-custom-condition-fields.png){width="70%" align="center"}

   >[!NOTE]
   >
   >「式を編集」ボタンを使用すると、Campaign の Web 式エディターを活用して、データベースのフィールドとヘルパー関数を使用して式を手動で定義できます。 [式の編集方法を学ぶ](expression-editor.md)

1. 適用する演算子をドロップダウンリストから選択します。様々な演算子が使用可能です。ドロップダウンリストで使用できる演算子は、属性のデータタイプによって異なります。

   +++使用可能な演算子のリスト

   | 演算子 | 目的 | 例 |
   |  ---  |  ---  |  ---  |
   | 次と等しい | 2 番目の「値」列に入力されたデータと同一の結果を返します。 | 姓（@lastName）が「佐藤」と等しいは、姓が佐藤の受信者のみを返します。 |
   | 次と等しくない | 入力された値と等しくないすべての値を返します。 | 言語（@language）が「英語」と等しくない。 |
   | 次の値より大きい | 入力された値より大きい値を返します。 | 年齢（@age）が 50 より大きい</strong>は、「50」より大きいすべての値（「51」、「52」など）を返します。 |
   | より小さい | 入力された値より小さい値を返します。 | 作成日（@created）が「DaysAgo(100)」より小さい</strong>は、過去 100 日以内に作成されたすべての受信者を返します。 |
   | 次よりも大きいか等しい | 入力された値より大きいか等しいすべての値を返します。 | 年齢（@age）が「30」よりも大きいか等しい</strong>は、30 歳以上のすべての受信者を返します。 |
   | 次よりも小さいか等しい | 入力された値より小さいか等しいすべての値を返します。 | 年齢（@age）が「60」よりも小さいか等しい</strong>は、60 歳以下のすべての受信者を返します。 |
   | 次に含まれる | 指定された値に含まれる結果を返します。これらの値はコンマで区切る必要があります。 | 生年月日（@birthDate）が「1979/12/10, 1984/12/10」に含まれる範囲は、これらの日付の間に生まれた受信者を返します。 |
   | 次に含まれない | 「次に含まれる」演算子と同様に機能します。ここでは、入力された値に基づいて受信者を除外します。 | 生年月日（@birthDate）が「1972/12/10, 1984/12/10」に含まれない。前の例とは異なり、これらの日付に生まれた受信者は返されません。 |
   | 空である | この場合、検索する結果は、2 番目の「値」列にある空の値と一致します。 | モバイル（@mobilePhone）が空であるは、モバイル番号がないすべての受信者を返します。 |
   | 空でない | 「空である」演算子の逆の機能です。2 番目の「値」列にあるデータを入力する必要はありません。 | メール（@email）は空でない。 |
   | 次で始まる | 入力された値で始まる結果を返します。 | アカウント番号（@account）が「32010」で始まる。 |
   | 次で始まらない | 入力された値で始まらない結果を返します。 | アカウント番号（@account）が「20」で始まらない。 |
   | 次を含む | 入力された値を含む結果を返します。 | メールドメイン（@domain）が「mail」を含む</strong>は、「mail」を含むすべてのドメイン名を返します。したがって、「gmail.com」ドメインも返されます。 |
   | 次を含まない | 入力された値を含まない結果を返します。 | メールドメイン（@domain）が「vo」を含まない</strong>。この場合、「vo」を含むドメイン名は返されません。結果には「voila.jp」ドメイン名は表示されません。 |
   | 次に類似 | 「次に類似」は、「次を含む」演算子とよく似ています。値に % ワイルドカード文字を挿入できます。 | 姓（@lastName）が「Jon%s」に類似している。ここでは、オペレーターが「n」と「s」の間の欠落している英数字を忘れたので、ワイルドカード文字が「Jones」という名前を検索するための「ジョーカー」として使用されています。 |
   | 次に類似しない | 「次に類似」は、「次を含む」演算子とよく似ています。値に % ワイルドカード文字を挿入できます。 | 姓（@lastName）が「Smi%h」に類似していない。この場合、姓が「Smi%h」の受信者は返されません。 |

+++

1. 「**値**」フィールドで、期待値を定義します。また、Campaign web 式エディターを利用して、データベースのフィールドとヘルパー関数を使用して式を手動で定義することもできます。これをおこなうには、 **式を編集** 」ボタンをクリックします。 [式の編集方法を学ぶ](expression-editor.md)

   *21 歳以上のすべてのプロファイルを返すクエリの例：*

   ![](assets/query-custom-condition.png){width="70%" align="center"}

#### リンクされたテーブルのカスタム条件（1 対 1 および 1 対多のリンク）{#links}

カスタム条件を使用すると、現在ルールで使用されているテーブルにリンクされたテーブルに対してクエリを実行できます。 これには、基数が 1-1 のテーブルや、コレクションテーブル（1-N リンク）が含まれます。

の **1-1 リンク**」で、リンクされたテーブルに移動し、目的の属性を選択して、期待される値を定義します。

+++クエリの例

ここでは、クエリは、ラベルが「実行中」のブランドをターゲティングしています。

1. 次の場所に移動： **ブランド** テーブルを開き、選択します。 **ラベル** 属性。

   ![](assets/1-1-attribute.png){width="70%" align="center"}

1. 属性の期待値を定義します。

   ![](assets/1-1-table.png){width="70%" align="center"}

+++

の **1 対多リンク**&#x200B;を使用すると、次の例に示すように、クエリを絞り込むためのサブ条件を定義できます。

+++クエリの例

ここでは、クエリは、BrewMaster 製品に関連する購入金額の合計が 100 ドル以上の受信者をターゲットにしています。

1. を選択します。 **購入** テーブルを開き、確定します。

   ![](assets/1-N-collection.png){width="70%" align="center"}

1. アウトバウンドトランジションが追加され、下位条件を作成できます。

   ![](assets/1-n-subcondition.png){width="70%" align="center"}

1. を選択します。 **価格** 1,000 ドル以上の属性とターゲットの購入

   ![](assets/1-n-price.png){width="70%" align="center"}

1. ニーズに合わせて下位条件を追加します。 ここでは、BrewMaster 製品を購入したプロファイルをターゲットにする条件を追加しました。

   ![](assets/custom-condition-1-N.png){width="70%" align="center"}

+++

#### 集計データの操作 {#aggregate}

カスタム条件を使用すると、集計操作を実行できます。 これをおこなうには、コレクションテーブルから属性を直接選択する必要があります。

1. 目的のコレクションテーブル内を移動し、集計操作を実行する属性を選択します。

   ![](assets/aggregate-attribute.png){width="70%" align="center"}

1. プロパティパネルで、 **データを集計** 」オプションを選択し、必要な集計関数を選択します。

   ![](assets/aggregate.png){width="70%" align="center"}

### オーディエンスを選択

>[!CONTEXTUALHELP]
>id="acw_orchestration_querymodeler_selectaudience"
>title="オーディエンスを選択"
>abstract="オーディエンスを選択"

既存のオーディエンスを使用してクエリをフィルタリングするには、次の手順に従います。

1. 目的のノードの「**+**」ボタンをクリックし、「**[!UICONTROL オーディエンスを選択]**」を選択します。

1. **オーディエンスを選択**&#x200B;プロパティパネルが右側に開きます。クエリのフィルタリングに使用するオーディエンスを選択します。

   *「フェスティバル来場者」オーディエンスに属するすべてのプロファイルを返すクエリの例：*

   ![](assets/query-audience.png)

### 定義済みフィルターを使用

>[!CONTEXTUALHELP]
>id="acw_orchestration_querymodeler_predefinedfilter"
>title="定義済みフィルター"
>abstract="定義済みフィルター"

定義済みフィルターを使用してクエリをフィルタリングするには、次の手順に従います。

1. 目的のノードの「**+**」ボタンをクリックし、「**[!UICONTROL 定義済みフィルター]**」を選択します。

1. **定義済みフィルター**&#x200B;プロパティパネルが右側に開きます。カスタムフィルターのリストまたはお気に入りから定義済みフィルターを選択します。

   *「非アクティブな顧客」定義済みフィルターに対応するすべてのプロファイルを返すクエリの例：*

   ![](assets/query-predefined-filter.png){width="70%" align="center"}

### コンポーネントのコピー&amp;ペースト {#copy}

クエリモデラーを使用すると、1 つまたは複数のフィルタリングコンポーネントをコピーして、トランジションの最後に貼り付けることができます。 この操作は、現在のクエリキャンバス内、またはインスタンス内の任意のキャンバスで実行できます。

>[!NOTE]
>
>コピーした選択は、インスタンスで作業している間、保持されます。 ログオフして再度ログインすると、選択内容は貼り付けできなくなります。

フィルタリングコンポーネントをコピー&amp;ペーストするには、次の手順に従います。

1. クエリキャンバスでコピーするフィルタリングコンポーネントをクリックして選択します。 複数のコンポーネントを選択するには、キャンバスの右上隅にあるツールバーにある複数選択ツールを使用します。

1. 次をクリック： **[!UICONTROL コピー]** ボタンをクリックします。複数のコンポーネントを選択した場合は、コンポーネントのプロパティペイン、または画面の下部にある青いリボンに表示されます。

   | 単一のコンポーネントのコピー | 複数のコンポーネントをコピー |
   |  ---  |  ---  |
   | ![](assets/copy-single-component.png){width="200" align="center" zoomable="yes"} | ![](assets/copy-multiple-components.png){width="200" align="center" zoomable="yes"} |

1. コンポーネントを貼り付けるには、目的のトランジションの末尾にある「 + 」ボタンをクリックし、「 」を選択します。 **項目を貼り付け**.

![](assets/copy-paste.png){width="70%" align="center"}

## フィルタリングコンポーネントと演算子を結合 {#operators}

>[!CONTEXTUALHELP]
>id="acw_orchestration_querymodeler_group"
>title="グループ"
>abstract="グループ"

新しいフィルターコンポーネントをクエリに追加するたびに、他のコンポーネントに自動的にリンクされます。 **および** 演算子を使用します。 つまり、2 つのフィルタリングコンポーネントの結果が組み合わされます。

この例では、2 つ目のトランジションに新しいオーディエンスタイプのフィルタリングコンポーネントを追加しました。このコンポーネントは、定義済みのフィルタータイプ条件に、 **および** 演算子を使用する場合と、クエリ結果には、「マドリディアン」という事前定義されたフィルター AND が「割引ハンター」オーディエンスに属する受信者が含まれます。

![](assets/query-operator.png){width="70%" align="center"}

フィルター条件を相互にリンクするために使用する演算子を変更するには、その演算子をクリックし、 **グループ化** 右側に開くウィンドウ枠。

使用可能な演算子を以下に示します。

* **AND（積集合）**：アウトバウンドトランジション内のすべてのフィルタリングコンポーネントと一致する結果を結合します。
* **OR（和集合）**：アウトバウンドトランジション内のフィルタリングコンポーネントの 1 つ以上と一致する結果が含まれます。
* **EXCEPT（除外）**：アウトバウンドトランジションのすべてのフィルタリングコンポーネントと一致する結果を除外します。

![](assets/query-operator-change.png){width="70%" align="center"}

また、 **+** ボタンをクリックします。 これにより、この特定の場所にオペレーターを追加して、複数のコンポーネントをグループ化し、クエリを絞り込むことができます。

次の例では、「報酬を受けるVIP」オーディエンスまたは「スーパーVIP」オーディエンスの結果を含める中間グループを作成しました。

![](assets/query-intermediate-group.png){width="70%" align="center"}

## クエリを確認および検証

>[!CONTEXTUALHELP]
>id="acw_orchestration_querymodeler_ruleproperties"
>title="ルールプロパティ"
>abstract="ルールプロパティ"

キャンバスでクエリを作成したら、右側にある&#x200B;**ルールのプロパティ**&#x200B;パネルを使用してクエリを確認できます。使用可能な操作を以下に示します。

* **結果を表示：**&#x200B;クエリから生成されたデータを表示します。
* **コードビュー**：クエリのコードベースバージョンを SQL で表示します。
* **計算**：クエリのターゲットとなるレコードの数を更新および表示します。
* **フィルターを選択または保存**：キャンバスで使用する既存の定義済みフィルターを選択するか、後で再利用できるように、クエリを定義済みフィルターとして保存します。[定義済みフィルターの操作方法の詳細情報](../get-started/predefined-filters.md)

  >[!IMPORTANT]
  >
  >ルールのプロパティパネルから定義済みフィルターを選択すると、キャンバスに作成されたクエリが選択したフィルターで置き換えられます。

クエリの準備が整ったら、 **[!UICONTROL 確認]** ボタンを使用して保存します。

クエリは、いつでも開いて変更できます。 既存のクエリを開くと、クエリは、  **+** ボタン。 クエリに新しい要素を追加するには、キャンバス上のコンポーネントまたは演算子を選択して、 **+** ボタン。
