---
audience: end-user
title: クエリモデラーを使用して最初のクエリを作成する
description: Adobe Campaign Web Query Modeler で最初のクエリを作成する方法を説明します。
source-git-commit: e78122b0788c04c39eac27231272cb96ad019bdc
workflow-type: tm+mt
source-wordcount: '1462'
ht-degree: 21%

---

# 最初のクエリを作成 {#build-query}

クエリの作成を開始するには、実行するアクションに応じて、選択した場所からクエリモデラーにアクセスします。 クエリモデラーが空白のキャンバスで開きます。 次をクリック： **+** ボタンをクリックして、クエリの最初のノードを設定します。

次の 2 種類の要素を追加できます。

* **コンポーネントのフィルタリング** （カスタム条件、オーディエンスを選択、定義済みフィルター）を使用すると、独自のルールを作成したり、オーディエンスまたは定義済みフィルターを選択してクエリを絞り込んだりできます。 [フィルタリングコンポーネントの操作方法を説明します。](#filtering)

  例：

  *「スポーツ」ニュースレターを購読した受信者*. *ニューヨークに住んでいる受信者*, *サンフランシスコに住んでいる受信者*

* **グループオペレーター** (AND、OR、EXCEPT) を使用すると、必要に応じて、ダイアグラム内のフィルタリングコンポーネントをグループ化できます。 [オペレーターの操作方法を説明します。](#filtering)

  例：

  *「スポーツ」ニュースレターを購読した受信者&#x200B;**および**ニューヨークに住む&#x200B;**または**サンフランシスコ*.

![](assets/query-add-component.png)

## フィルターコンポーネントを追加 {#filtering}

コンポーネントをフィルタリングすると、次を使用してクエリを絞り込むことができます。

* **カスタム条件**：データベースの属性と高度な式を使用して独自の条件を作成し、クエリをフィルタリングします。
* **オーディエンス**：既存のオーディエンスを使用してクエリをフィルタリングします。
* **定義済みフィルター**：既存の定義済みフィルターを使用してクエリをフィルタリングします。

### カスタム条件の設定

>[!CONTEXTUALHELP]
>id="acw_orchestration_querymodeler_customcondition"
>title="カスタム条件"
>abstract="カスタム条件"

カスタム条件を使用してクエリをフィルタリングするには、次の手順に従います。

1. 次をクリック： **+** ボタンをクリックし、「 」を選択します。 **[!UICONTROL カスタム条件]**. 右側にカスタム条件プロパティペインが開きます。

1. Adobe Analytics の **属性** 「 」フィールドで、条件の作成に利用する属性をデータベースから選択します。 属性リストには、テーブルにリンクされた属性を含め、Campaign データベースのすべての属性が含まれます。

   ![](assets/query-custom-condition-fields.png)

   >[!NOTE]
   >
   >「式を編集」ボタンを使用すると、Campaign の Web 式エディターを活用して、データベースのフィールドとヘルパー関数を使用して式を手動で定義できます。

1. 適用する演算子をドロップダウンリストから選択します。 様々な演算子を使用できます。 ドロップダウンリストで使用できる演算子は、属性のデータタイプによって異なることに注意してください。

   +++使用可能な演算子のリスト

   | 演算子 | 目的 | 例 |
   |  ---  |  ---  |  ---  |
   | 次と等しい | 2 番目の「値」列に入力されたデータと同一の結果を返します。 | 姓 (@lastName) が「佐藤」と等しいは、姓が佐藤の受信者のみを返します。 |
   | 次と等しくない | 入力された値と等しくないすべての値を返します。 | 言語 (@language) が「英語」と等しい |
   | 次の値より大きい | 入力された値より大きい値を返します。 | 年齢 (@age) が 50 を超えています</strong>は「50」より大きいすべての値（「51」、「52」など）を返します。 |
   | より小さい | 入力された値より小さい値を返します。 | 作成日 (@created) が「DaysAgo(100)」より前</strong>は、100 日未満に作成されたすべての受信者を返します。 |
   | 次よりも大きいか等しい | 入力された値より大きいか等しいすべての値を返します。 | 年齢 (@age) が「30」以上</strong>は、30 歳以上のすべての受信者を返します。 |
   | 次よりも小さいか等しい | 入力された値より小さいか等しいすべての値を返します。 | 年齢 (@age) が「60」以下</strong>は、60 歳以下のすべての受信者を返します。 |
   | 次に含まれる | 指定された値に含まれる結果を返します。これらの値はコンマで区切る必要があります。 | 生年月日 (@birthDate) が「12/10/1979,12/10/1984」に含まれる場合、はこれらの日付の間に生まれた受信者を返します。 |
   | 次に含まれない | 「次に含まれる」演算子と同様に機能します。 ここでは、入力された値に基づいて受信者を除外します。 | 生年月日 (@birthDate) が「12/10/1979,12/10/1984」に含まれていません。 前の例とは異なり、これらの日付の間に生まれた受信者は返されません。 |
   | 空である | この場合、検索する結果は、2 番目の「値」列にある空の値と一致します。 | モバイル (@mobilePhone) が空の場合は、モバイル番号を持たないすべての受信者を返します。 |
   | 空でない | 「空である」演算子の逆の機能です。 2 番目の「値」列にあるデータを入力する必要はありません。 | E メール (@email) が空ではありません。 |
   | 次で始まる | 入力された値で始まる結果を返します。 | アカウント番号（@account）が「32010」で始まる。 |
   | 次で始まらない | 入力された値で始まらない結果を返します。 | アカウント番号 (@account) が「20」で始まっていません |
   | 次を含む | 入力された値を含む結果を返します。 | E メールドメイン (@domain) に「mail」が含まれています</strong>は、「mail」を含むすべてのドメイン名を返します。 したがって、「gmail.com」ドメインも返されます。 |
   | 次を含まない | 入力された値を含まない結果を返します。 | E メールドメイン (@domain) が「vo」を含まない</strong>. この場合、「vo」を含むドメイン名は返されません。結果には「Voila.jp」ドメイン名は表示されません。 |
   | 次に類似 | 「次に類似」は、「次を含む」演算子とよく似ています。 値に%ワイルドカード文字を挿入できます。 | 姓 (@lastName) が「Jon%s」に類似している。 ここでは、オペレーターが「AB」と「345」の間の欠落している英数字を忘れたので、ワイルドカード文字が「ABS2345」という番号を検索するための「ジョーカー」として使用されています。 |
   | 次に類似しない | 「次に類似」は、「次を含む」演算子とよく似ています。 値に%ワイルドカード文字を挿入できます。 | 姓 (@lastName) が「Smi%h」に類似していない。 この場合、アカウント番号が「QR%789」の受信者は返されません。 |

+++

1. Adobe Analytics の **値** 「 」フィールドで、期待値を定義します。 また、Campaign の Web 式エディターを利用して、データベースのフィールドとヘルパー関数を使用して式を手動で定義することもできます。 これをおこなうには、 **式を編集** 」ボタンをクリックします。

   *21 歳以上のすべてのプロファイルを返すクエリの例：*

   ![](assets/query-custom-condition.png)

**距離テーブルのカスタム条件（1 対 1 および 1 対多リンク）**

カスタム条件を使用すると、受信者テーブルにリンクされた遠隔テーブルに対してクエリを実行できます。

の **1-1 リンク** 別のデータベースリソースで、対象となるテーブルから直接値を選択します。

+++クエリの例

ここでは、クエリは、国または地域が指定した値（英国と米国）に含まれている受信者をターゲティングしています

![](assets/custom-condition-1-1.png)

+++

の **1 対多リンク** 別のデータベースリソースを使用して、この 2 番目のリソースのフィールドに下位条件を定義できます。

例えば、購入プロファイルに対して「存在する」演算子を選択し、購入が存在するすべてのプロファイルをターゲットにすることができます。 完了したら、アウトバウンドトランジションにカスタム条件を追加し、必要に応じてフィルターを作成します。

+++クエリの例

このクエリでは、BrewMaster 製品に関連する購入を行った受信者をターゲットにし、合計 100$以上を取得します。

![](assets/custom-condition-1-N.png)

+++

### オーディエンスの選択

>[!CONTEXTUALHELP]
>id="acw_orchestration_querymodeler_selectaudience"
>title="オーディエンスを選択"
>abstract="オーディエンスを選択"

既存のオーディエンスを使用してクエリをフィルタリングするには、次の手順に従います。

1. 次をクリック： **+** ボタンをクリックし、「 」を選択します。 **[!UICONTROL オーディエンスを選択]**.

1. The **オーディエンスを選択** 右側にプロパティペインが開きます。 クエリのフィルタリングに使用するオーディエンスを選択します。

   *「Festival Goers」オーディエンスに属するすべてのプロファイルを返すクエリの例：*

   ![](assets/query-audience.png)

### 定義済みフィルターを使用

>[!CONTEXTUALHELP]
>id="acw_orchestration_querymodeler_predefinedfilter"
>title="定義済みフィルター"
>abstract="定義済みフィルター"

定義済みフィルターを使用してクエリをフィルターするには、次の手順に従います。

1. 次をクリック： **+** ボタンをクリックし、「 」を選択します。 **[!UICONTROL 定義済みフィルター]**.

1. The **定義済みフィルター** 右側にプロパティペインが開きます。 カスタムフィルターのリストまたはお気に入りから定義済みフィルターを選択します。

   *「非アクティブな顧客」事前定義フィルターに対応するすべてのプロファイルを返すクエリの例：*

   ![](assets/query-predefined-filter.png)

## フィルターコンポーネントと演算子の組み合わせ {#operators}

>[!CONTEXTUALHELP]
>id="acw_orchestration_querymodeler_group"
>title="グループ"
>abstract="グループ"

新しいフィルターコンポーネントをクエリに追加するたびに、AND 演算子によって他のコンポーネントに自動的にリンクされます。 つまり、両方のフィルタリングコンポーネントの結果が、クエリ結果に組み合わされます。

この例では、2 番目のトランジションに新しいオーディエンスタイプのフィルタリングコンポーネントを追加しました。 このコンポーネントは、定義済みのフィルタータイプ条件に AND 演算子でリンクされています。つまり、クエリ結果には、「Madridians」定義済みフィルター AND が「Discount hunters」オーディエンスに属する受信者が含まれます。

![](assets/query-operator.png)

フィルター条件を相互にリンクするために使用する演算子を変更するには、対象の演算子をクリックし、右側に開いたグループパネルで目的の演算子を選択します。

使用可能な演算子は次のとおりです。

* **AND（積集合）**：アウトバウンドトランジション内のすべてのフィルタリングコンポーネントと一致する結果を組み合わせます。
* **OR（和集合）**：アウトバウンドトランジション内のフィルタリングコンポーネントの 1 つ以上と一致する結果が含まれます。
* **EXCEPT （除外）**：アウトバウンドトランジションのすべてのフィルタリングコンポーネントに一致する結果を除外します。

![](assets/query-operator-change.png)

## クエリの確認と検証

>[!CONTEXTUALHELP]
>id="acw_orchestration_querymodeler_ruleproperties"
>title="ルールプロパティ"
>abstract="ルールプロパティ"

キャンバスでクエリを作成したら、 **ルールのプロパティ** 右側のパネル。 使用可能な操作は次のとおりです。

* **結果を表示：** クエリから生成されたデータを表示します。
* **コードビュー**:SQL でクエリのコードベースバージョンを表示します。
* **計算**：クエリのターゲットレコード数を更新して表示します。
* **フィルターを選択または保存**：キャンバスで使用する既存の定義済みフィルターを選択するか、後で再利用できるように事前定義済みフィルターとしてクエリを保存します。 [定義済みフィルターの操作方法の詳細情報](../get-started/predefined-filters.md)

  >[!IMPORTANT]
  >
  >ルールのプロパティウィンドウから定義済みフィルターを選択すると、キャンバスに作成されたクエリが、選択したフィルターに置き換えられます。
