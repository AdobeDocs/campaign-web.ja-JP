---
audience: end-user
title: JavaScript コードワークフローアクティビティの使用
description: JavaScript コードワークフローアクティビティの使用方法を学ぶ
exl-id: ca040ef8-5e0d-44e0-818d-08cfe99100be
source-git-commit: 1f5bd502527d0ba285e82fdda7b3f8dc86ac2c76
workflow-type: tm+mt
source-wordcount: '969'
ht-degree: 100%

---

# JavaScript コード {#javascript-code}

>[!CONTEXTUALHELP]
>id="acw_orchestration_javascript"
>title="JavaScript コード"
>abstract="**JavaScript コード**&#x200B;アクティビティは、ワークフローのコンテキスト内で JavaScript スクリプトを実行できます。これにより、アクションを実行したり、データベースから情報を収集したりできます。**シンプル** JavaScript コードアクティビティを使用して、ワークフローの実行時に 1 つのコードスニペットを実行します。**高度な** Javascript コードアクティビティを使用すると、2 つの異なるコードスニペットを順番に実行することで、より複雑な操作を実行できます。ワークフローを初めて開始する際には、最初の呼び出しが実行されます。ワークフローが再実行されるたびに、2 回目の呼び出しで定義されたコードが実行されます。"

>[!CONTEXTUALHELP]
>id="acw_orchestration_javascript_snippet"
>title="JavaScript スニペット"
>abstract="アクティビティの実行時に実行するスクリプトを定義します。**高度な** JavaScript アクティビティを設定している場合は、2 つのコードスニペット（ワークフローの最初の実行時に実行される最初の呼び出しコードと、ワークフローの次の呼び出し時に実行される次の呼び出しコード）を編集する必要があります。"

>[!CONTEXTUALHELP]
>id="acw_orchestration_javascript_execution"
>title="JavaScript の実行"
>abstract="実行遅延を設定して、一定期間の実行後にアクティビティを停止します。デフォルトでは、実行フェーズは 1 時間を超えることはできません。この遅延の後、エラーメッセージが表示されてプロセスが中止され、アクティビティの実行が失敗します。この制限を無視するには、値を 0 に設定します。"

>[!CONTEXTUALHELP]
>id="acw_orchestration_javascript_transition"
>title="JavaScript のトランジション"
>abstract="1 つまたは複数の出力トランジションを追加するには、「**[!UICONTROL トランジションを追加]**」ボタンをクリックし、トランジションごとにラベルと内部名を指定します。"

>[!CONTEXTUALHELP]
>id="acw_orchestration_javascript_processerrors"
>title="エラーを処理"
>abstract="「**[!UICONTROL エラーを処理]**」オプションを有効にすると、スクリプトの実行中に発生したエラーが追加の出力トランジションで保持されます。"

**JavaScript コード**&#x200B;アクティビティは、**データ管理**&#x200B;アクティビティです。このアクティビティを使用して、ワークフローのコンテキストで JavaScript スクリプトを実行します。これにより、データベースから情報を収集したり、その他の複雑な操作を実行したりできます。

## JavaScript コードアクティビティの設定 {#javascript-code-configuration}

「**JavaScript コード**」アクティビティを設定するには、次の手順に従います。

1. 「**JavaScript コード**」アクティビティをワークフローに追加します。

1. 作成するアクティビティのタイプを選択します。

   * **シンプル**：1 つのコードスニペットを実行します。
   * **詳細**：このオプションを使用すると、2 つの異なるコードスニペットを実行することで、より高度な操作を実行できます。[JavaScript アクティビティの設定方法を学ぶ](#advanced)

   >[!NOTE]
   >
   >Campaign web ユーザーインターフェイスでは、**シンプル**&#x200B;な JavaScript コードと&#x200B;**高度**&#x200B;な JavaScript コードの両方の機能を結合して、2 つのアクティビティを 1 つにまとめました。この統合によるアクティビティの機能への影響は一切ありません。

1. 確認してから、「**[!UICONTROL コードを編集]**」ボタンをクリックして、式エディターを開きます。左側のペインには、イベント変数などの、コードの作成に利用できる定義済みの構文が表示されます。[イベント変数と式エディターの操作方法を学ぶ](../event-variables.md)

   ![](../assets/javascript-editor.png)

1. 「**[!UICONTROL 実行]**」セクションでは、一定期間の実行後にアクティビティを停止する遅延を設定します。デフォルトでは、実行フェーズは 1 時間を超えることはできません。この遅延の後、エラーメッセージが表示されてプロセスが中止され、アクティビティの実行が失敗します。この制限を無視するには、値を 0 に設定します。

   ![](../assets/javascript-config.png)

1. 「**[!UICONTROL エラーを処理]**」オプションを有効にすると、スクリプトの実行中に発生したエラーを、追加の出力トランジションに保持できます。

## 高度な JavaScript コードアクティビティ {#advanced}

高度な JavaScript アクティビティを使用すると、複雑な操作を実行できます。これにより、次の操作を実行できます。

* 2 つの異なるコードスニペットを実行します。最初のコードスニペットは、ワークフローの初回起動時に実行されます。ワークフローが再度実行されるたびに、2 回目の呼び出しで定義されたコードスニペットが実行されます。
* スクリプトを使用して動的にやり取りできる複数の出力トランジションを追加します。

高度な JavaScript コードアクティビティを設定するには、次の手順に従います。

1. 「**詳細**」タイプを選択し、実行するコードスニペット（複数可）を設定します。

   * 「**[!UICONTROL 最初の呼び出しコードを編集]**」をクリックし、最初の呼び出しで実行するスクリプトを定義します。
   * 「**[!UICONTROL 次の呼び出しコードを編集]**」をクリックし、ワークフローの次回の呼び出しで実行するスクリプトを定義します。（オプション）

1. 1 つまたは複数の出力トランジションを追加するには、**[!UICONTROL トランジションを追加]**&#x200B;ボタンをクリックし、トランジションごとにラベルと内部名を指定します。

   この例では、特定の条件に基づいて、コードスニペット内のスクリプトでアクティブ化される 2 つのトランジションを設定しています。

   ![](../assets/javascript-transitions.png)

1. アクティビティの設定を完了し、ワークフローを開始します。

## 例 {#javascript-code-example}

### 入力母集団に基づく変数の初期化 {#example1}

この例は、ワークフローがターゲットとするプロファイルの数に基づいて変数を初期化する方法を示しています。

![](../assets/javascript-example1.png)

ここでは、データベースから VIP プロファイルをターゲットにしています。オーディエンス作成アクティビティがターゲットとするプロファイルの数に応じた値を持つ「channel」という変数を作成します。

* 1,000 個を超えるプロファイルをターゲットにする場合は、「email」の値を使用して変数を初期化します。
* それ以外の場合は、「sms」の値で初期化します。

これを行うには、次の手順に従います。

1. **オーディエンス作成**&#x200B;アクティビティの後に、タイプが&#x200B;**シンプル**&#x200B;の **JavaScript コード**&#x200B;アクティビティを追加します。

1. 「**コードを編集**」をクリックし、コードスニペットを次のように設定します。

   ```
   if (vars.recCount > 1000)
       vars.channel ="email"
   else
       vars.channel = "sms"
   ```

1. ワークフローを開始します。「channel」変数は、**オーディエンス作成**&#x200B;アクティビティがターゲットとするプロファイルの数に応じて、「email」または「sms」の値で作成されます。

### 変数の値に基づくトランジションのトリガー {#example2}

この例は、変数の値に基づいてトランジションをトリガーする方法を示しています。

![](../assets/javascript-example2-transitions.png)

ここでは、ワークフローが&#x200B;**外部シグナル**&#x200B;アクティビティで始まり、変数（`interest`）が別のワークフローから渡されます。変数の値は、最初のワークフローで実行されるフィルタリング操作に応じて、「running」または「yoga」になります。

変数の値に基づいて、ワークフロー内の様々なトランジションをトリガーします。

これを行うには、次の手順に従います。

1. 「外部シグナル」アクティビティの後で、タイプが&#x200B;**詳細**&#x200B;の&#x200B;**JavaScript コード**&#x200B;アクティビティを追加します。

1. 2 つのトランジションを追加します（1 つは設定可能な各変数値（「running」、「yoga」））。

1. 「**最初の呼び出しコードを編集**」をクリックし、コードスニペットを次のように設定します。

   ```
   if (vars.interest=="running")
       task.postEvent(task.transitionByName("running"));
   else
       task.postEvent(task.transitionByName("yoga"));
   ```

1. ニーズに合わせて各トランジションの設定を完了し、ワークフローを開始します。2 つの出力トランジションのうちの 1 つが、**外部シグナル**&#x200B;アクティビティを通じて渡された `interest` 変数に基づいてアクティブ化されます。
