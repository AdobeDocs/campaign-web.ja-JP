---
audience: end-user
title: 増分クエリワークフローアクティビティの使用
description: 増分クエリワークフローアクティビティの使用方法を学ぶ
exl-id: 72bd307b-eba2-42a0-9744-05e089c34925
source-git-commit: b9f3deb579cf786e0eafa57f42a728b3f7a002d1
workflow-type: ht
source-wordcount: '716'
ht-degree: 100%

---

# 増分クエリ {#incremental-query}

>[!CONTEXTUALHELP]
>id="acw_orchestration_incrementalquery"
>title="増分クエリ"
>abstract="**増分クエリ**&#x200B;アクティビティとは、クエリモデラーを使用してデータベースでクエリを実行できる&#x200B;**ターゲティング**&#x200B;アクティビティを意味します。このアクティビティが実行されるたびに、以前の実行結果が除外されます。これにより、新しい要素だけをターゲットにすることができます。"

>[!CONTEXTUALHELP]
>id="acw_orchestration_incrementalquery_history"
>title="増分処理クエリ履歴"
>abstract="増分処理クエリ履歴"

>[!CONTEXTUALHELP]
>id="acw_orchestration_incrementalquery_processeddata"
>title="増分クエリの処理済みデータ"
>abstract="増分クエリの処理済みデータ"

**増分クエリ**&#x200B;アクティビティとは、定期的にデータベースでクエリを実行できる&#x200B;**ターゲティング**&#x200B;アクティビティを意味します。このアクティビティが実行されるたびに、以前の実行結果が除外されます。これにより、新しい要素だけをターゲットにすることができます。

>[!NOTE]
>
>Campaign クライアントコンソールでは、**[!UICONTROL 増分クエリ]**&#x200B;アクティビティがビルトインのスケジューラーと統合されていますが、Campaign web ユーザーインターフェイスではこの機能が個別に扱われます。増分クエリの実行をスケジュールするには、**[!UICONTROL 増分クエリ]**&#x200B;アクティビティを実行する前に、ワークフローに&#x200B;**[!UICONTROL スケジューラー]**&#x200B;アクティビティを追加します。[スケジューラーアクティビティの設定方法を学ぶ](scheduler.md)

**[!UICONTROL 増分クエリ]**&#x200B;アクティビティは、次のような様々な用途に使用できます。

* 個人をセグメント化して、メッセージ、オーディエンスまたはその他の操作のターゲットを定義する。
* データをエクスポートする。例えば、アクティビティを使用して、定期的にファイルに新規ログをエクスポートします。これは、外部レポートやビジネスインテリジェンスツールで役立ちます。

以前の実行で既にターゲットになっている母集団は、ワークフローに保存されます。同じテンプレートから開始された 2 つのワークフローは同じログを共有しません。一方、同じワークフロー内の同じ増分クエリに基づく 2 つのタスクは、同じログを使用します。

実行中のいずれかの増分クエリの結果が 0 と等しい場合、プログラムされた次回のクエリの実行まで、ワークフローは一時停止されます。増分クエリに続くトランザクションとアクティビティが、次回の実行前に処理されることはありません。

## 増分クエリアクティビティの設定 {#incremental-query-configuration}

**増分クエリ**&#x200B;アクティビティを設定するには、次の手順に従います。

[説明：Adobe Campaign の増分クエリアクティビティの設定インターフェイスを示すスクリーンショット。]\
![](../assets/incremental-query.png)

1. ワークフローに&#x200B;**増分クエリ**&#x200B;アクティビティを追加します。

1. 「**[!UICONTROL オーディエンス]**」セクションで「**ターゲティングディメンション**」を選択し、「**[!UICONTROL 続行]**」をクリックします。

   ターゲティングディメンションは、オペレーションの対象となる母集団を定義します。これには、受信者、契約受益者、オペレーター、サブスクライバーなどが含まれます。デフォルトでは、ターゲットが受信者から選択されます。[ターゲティングディメンションについての詳細を学ぶ](../../audience/about-recipients.md#targeting-dimensions)

1. 新しいメールをデザインする際にオーディエンスを作成するのと同じ方法で、クエリモデラーを使用してクエリを定義します。[詳しくは、クエリモデラーの操作方法を参照してください。](../../query/query-modeler-overview.md)

1. 「**[!UICONTROL 処理済みのデータ]**」セクションで、使用する増分モードを選択します。

   * **[!UICONTROL 以前の実行結果を除外]**：アクティビティを実行するたびに、前回の実行結果が除外されます。

     以前の実行でターゲットに設定された受信者は、ターゲットに設定された日からの経過日数が最大値に達するまでログに記録することができます。この値を設定するには、「**[!UICONTROL 履歴（日数）]**」フィールドを使用します。 値がゼロの場合、受信者がログからパージされることはありません。

   * **[!UICONTROL 日付フィールドを使用]**：このオプションは、特定の日付フィールドに基づいて、以前の実行の結果を除外します。選択したターゲティングディメンションで使用できる属性のリストから目的の日付フィールドを選択します。ワークフローの後続の実行時には、最後の実行日より後に変更または作成されたデータのみが取得されます。

     ワークフローを最初に実行した後、「**[!UICONTROL 最終実行日]**」フィールドが使用可能になります。このフィールドで次の実行の日付が指定され、ワークフローを実行するたびに自動的に更新されます。この値は、必要に応じて手動で上書きできます。

   >[!NOTE]
   >
   >**[!UICONTROL 日付フィールドを使用]**&#x200B;モードでは、選択された日付フィールドに応じて、より柔軟な指定が可能です。例えば、指定したフィールドが変更日に対応する場合、日付フィールドモードでは、最近更新されたデータが取得されます。他のモードでは、ワークフローの最後の実行以降に変更があった場合でも、前回の実行でターゲットになったレコードは除外されます。

## 例 {#incremental-query-example}

次の例は、Adobe Campaign データベース内のプロファイルを毎週フィルタリングするワークフローの設定を示しています。「ヨガのニュースレター」サービスを購読している個人をターゲットにし、ウェルカムメールを送信します。

![「ヨガのニュースレター」サービスを購読しているプロファイルをフィルタリングするためのワークフロー設定の例のスクリーンショット。](../assets/incremental-query-example.png)

ワークフローには、次の要素が含まれます。

* **[!UICONTROL スケジューラー]**&#x200B;アクティビティ：毎週月曜日午前 6 時にワークフローを実行します。
* **[!UICONTROL 増分クエリ]**&#x200B;アクティビティ：初回実行時には、その時点の全購読者をターゲットにし、後続の実行時には、新規購読者だけをターゲットにします。
* **[!UICONTROL メール配信]**&#x200B;アクティビティ